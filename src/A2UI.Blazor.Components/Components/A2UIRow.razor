@inherits A2UIComponentBase

<div class="@GetCssClass()" style="@GetCombinedStyle()">
    @if (ChildrenIds != null)
    {
        @foreach (var childId in ChildrenIds)
        {
            <A2UIRenderer SurfaceId="@SurfaceId" ComponentId="@childId" DataContextPath="@Component.DataContextPath" />
        }
    }
</div>

@code {
    private List<string>? ChildrenIds;
    private string? Distribution;
    private string? Alignment;

    protected override void OnParametersSet()
    {
        base.OnParametersSet();

        var childrenData = GetDictionaryProperty("children");
        if (childrenData != null && childrenData.TryGetValue("explicitList", out var explicitList))
        {
            Console.WriteLine($"[A2UIRow] explicitList type: {explicitList?.GetType().FullName}, value: {explicitList}");
            
            if (explicitList is List<string> stringList)
            {
                ChildrenIds = stringList.ToList();
            }
            else if (explicitList is List<object> objectList)
            {
                ChildrenIds = objectList.Select(x => x?.ToString()).Where(x => !string.IsNullOrEmpty(x)).ToList()!;
            }
            else if (explicitList is string[] stringArray)
            {
                ChildrenIds = stringArray.ToList();
            }
            else if (explicitList is object[] objectArray)
            {
                ChildrenIds = objectArray.Select(x => x?.ToString()).Where(x => !string.IsNullOrEmpty(x)).ToList()!;
            }
            else if (explicitList is System.Text.Json.JsonElement jsonElement)
            {
                try
                {
                    ChildrenIds = System.Text.Json.JsonSerializer.Deserialize<List<string>>(jsonElement.GetRawText()) ?? new List<string>();
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"[A2UIRow] Failed to deserialize explicitList: {ex.Message}");
                    ChildrenIds = new List<string>();
                }
            }
            else
            {
                Console.WriteLine($"[A2UIRow] Unexpected explicitList type: {explicitList?.GetType().FullName}");
                ChildrenIds = new List<string>();
            }
            
            Console.WriteLine($"[A2UIRow] ChildrenIds count: {ChildrenIds?.Count ?? 0}, IDs: {string.Join(", ", ChildrenIds ?? new List<string>())}");
        }

        Distribution = GetStringProperty("distribution");
        Alignment = GetStringProperty("alignment");
    }

    protected override string GetCssClass()
    {
        return Theme.Components.Row;
    }

    private string GetCombinedStyle()
    {
        var styles = new List<string> { GetInlineStyle() };

        if (!string.IsNullOrEmpty(Distribution))
        {
            var justifyContent = Distribution.ToLower() switch
            {
                "start" => "flex-start",
                "end" => "flex-end",
                "center" => "center",
                "spacebetween" => "space-between",
                "spacearound" => "space-around",
                "spaceevenly" => "space-evenly",
                _ => "flex-start"
            };
            styles.Add($"justify-content: {justifyContent}");
        }

        if (!string.IsNullOrEmpty(Alignment))
        {
            var alignItems = Alignment.ToLower() switch
            {
                "start" => "flex-start",
                "end" => "flex-end",
                "center" => "center",
                "stretch" => "stretch",
                "baseline" => "baseline",
                _ => "stretch"
            };
            styles.Add($"align-items: {alignItems}");
        }

        return string.Join("; ", styles.Where(s => !string.IsNullOrEmpty(s)));
    }
}

