# å½“AIå¼€å§‹"ç”»"ç•Œé¢ï¼šA2UIåè®®å¦‚ä½•è®©.NETåº”ç”¨å‘Šåˆ«å†™æ­»çš„UI

> **ä¸€å¥è¯æ¢—æ¦‚**ï¼šæƒ³è±¡ä¸€ä¸‹ï¼Œä½ è·ŸAIè¯´"ç»™æˆ‘æ˜¾ç¤ºé™„è¿‘çš„é¤å…",å®ƒä¸ä»…èƒ½æ‰¾å‡ºç­”æ¡ˆ,è¿˜èƒ½å³æ—¶"ç”»"å‡ºä¸€ä¸ªç²¾ç¾çš„å¡ç‰‡åˆ—è¡¨ç•Œé¢â€”â€”è¿™ä¸æ˜¯ç§‘å¹»,è¿™æ˜¯Google A2UIåè®®åœ¨.NET Blazorä¸­çš„çœŸå®è½åœ°ã€‚

---

## å¼•å­ï¼šé‚£ä¸ªè®©å‰ç«¯å·¥ç¨‹å¸ˆå¤œä¸èƒ½å¯çš„é—®é¢˜

ä½œä¸ºä¸€ä¸ªå†™äº†åå¹´ä»£ç çš„è€æ²¹æ¡ï¼Œæˆ‘è§è¿‡å¤ªå¤š"éœ€æ±‚åˆåŒå’å•æ”¹äº†"çš„æ·±å¤œã€‚äº§å“ç»ç†æ‹¿ç€åŸå‹å›¾å†²è¿‡æ¥:"è¿™ä¸ªåˆ—è¡¨èƒ½ä¸èƒ½æ”¹æˆå¡ç‰‡?"ã€"èƒ½ä¸èƒ½æ ¹æ®ç”¨æˆ·æƒé™åŠ¨æ€æ˜¾ç¤ºæŒ‰é’®?"ã€"è¿™ä¸ªè¡¨å•å­—æ®µä¸‹å‘¨å¯èƒ½è¦åŠ 10ä¸ª..."

æ¯æ¬¡å¬åˆ°è¿™äº›,æˆ‘çš„ç¬¬ä¸€ååº”éƒ½æ˜¯:å¾—,ä»Šæ™šåˆè¦é€šå®µæ”¹JSX/Razorä»£ç äº†ã€‚

ä½†å¦‚æœæˆ‘å‘Šè¯‰ä½ ,æœ‰ä¸€ç§æŠ€æœ¯èƒ½è®©**AI Agentç›´æ¥ç”ŸæˆUI**,ä½ åªéœ€è¦å‘Šè¯‰å®ƒ"æˆ‘è¦ä»€ä¹ˆ",å®ƒå°±èƒ½è¿”å›ä¸€ä¸ªå®Œæ•´çš„ã€å¯äº¤äº’çš„ã€ç¬¦åˆä½ åº”ç”¨é£æ ¼çš„ç•Œé¢,ä½ ä¿¡å—?

è¿™å°±æ˜¯Googleåœ¨2024å¹´åº•æ¨å‡ºçš„**A2UIåè®®**(Agent to UI)æƒ³è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€‚è€Œæˆ‘æœ€è¿‘æŠŠç©çš„è¿™ä¸ªå¼€æºé¡¹ç›®â€”â€”**A2UI for .NET Blazor**,æ›´æ˜¯æŠŠè¿™å¥—ç†å¿µåœ¨.NETç”Ÿæ€é‡Œè½åœ°å¾—æ˜æ˜ç™½ç™½ã€‚

ä»Šå¤©,å’±ä»¬å°±æ’•å¼€è¿™å±‚æŠ€æœ¯çš„é¢çº±,çœ‹çœ‹å®ƒåˆ°åº•æ˜¯å¦‚ä½•è¿ä½œçš„,ä»¥åŠä¸ºä»€ä¹ˆæˆ‘è®¤ä¸ºå®ƒå¯èƒ½ä¼šæ”¹å˜æˆ‘ä»¬æ„å»ºåº”ç”¨çš„æ–¹å¼ã€‚

---

## ç¬¬ä¸€ç« ï¼šä¸æ˜¯ç„å­¦,æ˜¯å£°æ˜å¼UIçš„ç»ˆæè¿›åŒ–

### 1.1 å…ˆææ¸…æ¥šä¸€ä¸ªé—®é¢˜:ä»€ä¹ˆæ˜¯A2UI?

ç®€å•æ¥è¯´,A2UIæ˜¯ä¸€ä¸ª**JSONåè®®**ã€‚å®ƒå®šä¹‰äº†AI Agentå¦‚ä½•ç”¨å£°æ˜å¼æ•°æ®æè¿°ç”¨æˆ·ç•Œé¢,è€Œä¸æ˜¯ç”Ÿæˆå¯æ‰§è¡Œä»£ç ã€‚

å¬èµ·æ¥å¾ˆæŠ½è±¡?æˆ‘ä»¬æ¥çœ‹ä¸ªå¯¹æ¯”:

**ä¼ ç»Ÿæ–¹å¼(å±é™©âš ï¸):**
```javascript
// AI è¿”å›è¿™æ®µä»£ç è®©ä½ æ‰§è¡Œ
eval(`
  const btn = document.createElement('button');
  btn.onclick = () => { 
    fetch('/api/delete-everything'); // ğŸ’€å±é™©!
  };
`)
```

**A2UIæ–¹å¼(å®‰å…¨âœ…):**
```json
{
  "component": {
    "Button": {
      "child": "btn-text",
      "action": { "name": "delete_item" }
    }
  }
}
```

çœ‹å‡ºåŒºåˆ«äº†å—?ç¬¬ä¸€ç§æ–¹å¼AIå¯ä»¥è®©ä½ çš„æµè§ˆå™¨æ‰§è¡Œä»»æ„ä»£ç (æƒ³æƒ³çœ‹,å¦‚æœAIè¢«é»‘äº†å‘¢?),è€Œç¬¬äºŒç§æ–¹å¼åªæ˜¯å‘Šè¯‰ä½ "è¿™é‡Œåº”è¯¥æœ‰ä¸€ä¸ªæŒ‰é’®,ç‚¹å‡»åè§¦å‘delete_itemåŠ¨ä½œ"ã€‚è‡³äºè¿™ä¸ªåŠ¨ä½œå…·ä½“åšä»€ä¹ˆ,å®Œå…¨ç”±ä½ çš„åº”ç”¨ä»£ç æ§åˆ¶ã€‚

è¿™å°±æ˜¯**å£°æ˜å¼æ•°æ® vs å¯æ‰§è¡Œä»£ç **çš„æœ¬è´¨åŒºåˆ«ã€‚Googleçš„å·¥ç¨‹å¸ˆæŠŠè¿™ä¸ªç†å¿µæ€»ç»“ä¸ºä¸‰å¤§æ ¸å¿ƒä»·å€¼:

1. **å®‰å…¨æ€§(Security)**: å£°æ˜å¼æ•°æ®,æ— ä»£ç æ‰§è¡Œé£é™©
2. **åŸç”Ÿä½“éªŒ(Native Experience)**: ä½¿ç”¨åº”ç”¨è‡ªå·±çš„UIæ¡†æ¶æ¸²æŸ“,ç»§æ‰¿åº”ç”¨æ ·å¼å’Œæ€§èƒ½
3. **å¯ç§»æ¤æ€§(Portability)**: åŒä¸€ä»½JSONå¯ä»¥åœ¨Webã€ç§»åŠ¨ã€æ¡Œé¢å¹³å°æ¸²æŸ“

### 1.2 ä¸ºä»€ä¹ˆè¯´å®ƒæ˜¯"ç»ˆæè¿›åŒ–"?

å›æƒ³ä¸€ä¸‹UIæŠ€æœ¯çš„æ¼”è¿›è·¯å¾„:

```
å‘½ä»¤å¼UI (jQueryæ—¶ä»£)
   â†“
å£°æ˜å¼UI (React/Vue/Blazor)
   â†“
ç»„ä»¶åŒ–UI (Ant Design/Material UI)
   â†“
AIç”ŸæˆUI (A2UI) â† æˆ‘ä»¬åœ¨è¿™é‡Œ
```

æ¯ä¸€æ¬¡æ¼”è¿›éƒ½åœ¨è§£å†³ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜:**å¦‚ä½•ç”¨æ›´å°‘çš„ä»£ç è¡¨è¾¾æ›´å¤æ‚çš„ç•Œé¢**ã€‚

- jQueryæ—¶ä»£:æ‰‹åŠ¨æ“ä½œDOM,å†™100è¡Œä»£ç å®ç°ä¸€ä¸ªåˆ—è¡¨
- Reactæ—¶ä»£:å£°æ˜å¼æè¿°çŠ¶æ€,å†™30è¡Œä»£ç å®ç°åŒæ ·çš„åˆ—è¡¨
- ç»„ä»¶åŒ–æ—¶ä»£:ç›´æ¥ç”¨`<List />`ç»„ä»¶,5è¡Œä»£ç æå®š
- A2UIæ—¶ä»£:è·ŸAIè¯´"æ˜¾ç¤ºè”ç³»äººåˆ—è¡¨",0è¡ŒUIä»£ç 

æ˜¯çš„,ä½ æ²¡çœ‹é”™,**0è¡ŒUIä»£ç **ã€‚ä½ åªéœ€è¦ç»´æŠ¤ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®,UIå®Œå…¨ç”±AIåŠ¨æ€ç”Ÿæˆã€‚

---

## ç¬¬äºŒç« ï¼šæ·±å…¥æŠ€æœ¯æ¶æ„â€”â€”è¿™ç©æ„å„¿åˆ°åº•æ€ä¹ˆè·‘èµ·æ¥çš„?

å¥½,å¹ç‰›Xçš„è¯è¯´å®Œäº†,ç°åœ¨è¯¥ç¡¬æ ¸åˆ†æäº†ã€‚å’±ä»¬æ¥æ‹†è§£ä¸€ä¸‹A2UIåœ¨.NET Blazorä¸­çš„å®Œæ•´æ¶æ„ã€‚

### 2.1 æ¶æ„å…¨æ™¯å›¾:äº”å±‚æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·å±‚ (User)                       â”‚
â”‚                "æ˜¾ç¤ºé™„è¿‘çš„é¤å…"                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å®¢æˆ·ç«¯å±‚ (Client)                        â”‚
â”‚              A2AClientService + EventDispatcher          â”‚
â”‚        è´Ÿè´£:å‘é€æŸ¥è¯¢ã€æ¥æ”¶JSONã€åˆ†å‘ç”¨æˆ·åŠ¨ä½œ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Agentå±‚ (AI LLM)                        â”‚
â”‚                MockA2AAgent / Gemini / GPT              â”‚
â”‚        è´Ÿè´£:ç†è§£æ„å›¾ã€ç”ŸæˆA2UI JSONå“åº”                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å¤„ç†å±‚ (Processing)                      â”‚
â”‚              MessageProcessor + DataBindingResolver      â”‚
â”‚     è´Ÿè´£:è§£æJSONã€æ„å»ºç»„ä»¶æ ‘ã€ç®¡ç†æ•°æ®æ¨¡å‹                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ¸²æŸ“å±‚ (Rendering)                       â”‚
â”‚           A2UISurface + A2UIRenderer + 15+ç»„ä»¶           â”‚
â”‚       è´Ÿè´£:åŠ¨æ€æ¸²æŸ“Blazorç»„ä»¶ã€å¤„ç†ç”¨æˆ·äº¤äº’                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

è¿™ä¸ªæ¶æ„æœ€ç²¾å¦™çš„åœ°æ–¹åœ¨äº:**èŒè´£åˆ†ç¦»**ã€‚æ¯ä¸€å±‚åªå…³å¿ƒè‡ªå·±è¯¥å¹²çš„äº‹,Agentåªè´Ÿè´£ç”ŸæˆJSON,å®ƒå®Œå…¨ä¸çŸ¥é“ä¹Ÿä¸å…³å¿ƒè¿™ä¸ªJSONæœ€ç»ˆä¼šè¢«æ¸²æŸ“æˆä»€ä¹ˆæ ·å­ã€‚

### 2.2 æ ¸å¿ƒç±»è¯¦è§£:äº”å¤§é‡‘åˆš

#### é‡‘åˆš1: MessageProcessorâ€”â€”JSONçš„ç¿»è¯‘å®˜

è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å¿ƒè„ã€‚å®ƒæ¥æ”¶AIè¿”å›çš„JSONæ¶ˆæ¯,è§£ææˆå†…éƒ¨æ•°æ®ç»“æ„,ç»´æŠ¤ç€æ‰€æœ‰Surface(æ¸²æŸ“è¡¨é¢)çš„çŠ¶æ€ã€‚

```csharp
public class MessageProcessor
{
    // ç»´æŠ¤æ‰€æœ‰ Surface çš„å­—å…¸,keyæ˜¯surfaceId
    private readonly Dictionary<string, Surface> _surfaces = new();
    
    // äº‹ä»¶:å½“Surfaceæ›´æ–°æ—¶é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…
    public event EventHandler<SurfaceUpdatedEventArgs>? SurfaceUpdated;
    
    // æ ¸å¿ƒæ–¹æ³•:å¤„ç†ä¸‰ç§æ¶ˆæ¯ç±»å‹
    public void ProcessMessage(ServerToClientMessage message)
    {
        if (message.BeginRendering != null)
            HandleBeginRendering(message.BeginRendering);
        else if (message.SurfaceUpdate != null)
            HandleSurfaceUpdate(message.SurfaceUpdate);
        else if (message.DataModelUpdate != null)
            HandleDataModelUpdate(message.DataModelUpdate);
    }
}
```

å…³é”®è®¾è®¡ç‚¹:
1. **Surfaceéš”ç¦»**:æ¯ä¸ªSurfaceæœ‰ç‹¬ç«‹çš„ç»„ä»¶æ ‘å’Œæ•°æ®æ¨¡å‹,äº’ä¸å¹²æ‰°
2. **äº‹ä»¶é©±åŠ¨**:ä½¿ç”¨.NETäº‹ä»¶æœºåˆ¶,å½“æ•°æ®å˜åŒ–æ—¶è‡ªåŠ¨é€šçŸ¥UIæ›´æ–°
3. **å¢é‡æ›´æ–°**:SurfaceUpdateåªæ›´æ–°å˜åŒ–çš„ç»„ä»¶,ä¸æ˜¯å…¨é‡æ›¿æ¢

æˆ‘ç‰¹åˆ«å–œæ¬¢å®ƒå¤„ç†`BeginRendering`çš„æ–¹å¼:

```csharp
private void HandleBeginRendering(BeginRenderingMessage message)
{
    var surface = GetOrCreateSurface(message.SurfaceId);
    
    // æ¸…é™¤æ—§ç»„ä»¶,å¼€å§‹æ–°çš„æ¸²æŸ“å‘¨æœŸ
    surface.Components.Clear();
    
    surface.RootComponentId = message.Root;
    surface.IsReadyToRender = true; // ğŸ”¥å…³é”®:è®¾ç½®æ¸²æŸ“å°±ç»ªæ ‡å¿—
    
    OnSurfaceUpdated(message.SurfaceId); // è§¦å‘æ›´æ–°äº‹ä»¶
}
```

è¿™ä¸ª`IsReadyToRender`æ ‡å¿—è§£å†³äº†ä¸€ä¸ªå¾®å¦™çš„é—®é¢˜:åœ¨ç»„ä»¶å®šä¹‰è¿˜æ²¡å®Œå…¨åŠ è½½æ—¶,ä¸è¦å°è¯•æ¸²æŸ“ã€‚è¿™é¿å…äº†"é—ªçƒ"å’Œä¸å®Œæ•´UIçš„é—®é¢˜ã€‚

#### é‡‘åˆš2: A2UISurfaceâ€”â€”Blazorä¸­çš„æ¸²æŸ“ç”»å¸ƒ

è¿™æ˜¯ç”¨æˆ·åœ¨Razoré¡µé¢ä¸­å®é™…ä½¿ç”¨çš„ç»„ä»¶:

```razor
<A2UISurface SurfaceId="my-surface" />
```

å®ƒçš„å®ç°éå¸¸å·§å¦™:

```csharp
@if (Surface != null && Surface.IsReadyToRender && !string.IsNullOrEmpty(Surface.RootComponentId))
{
    <div class="a2ui-surface">
        <A2UIRenderer SurfaceId="@SurfaceId" ComponentId="@Surface.RootComponentId" />
    </div>
}
else
{
    <div class="a2ui-surface-debug">
        <!-- æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ -->
    </div>
}

@code {
    protected override void OnInitialized()
    {
        // ğŸ”¥å…³é”®:è®¢é˜…Surfaceæ›´æ–°äº‹ä»¶
        MessageProcessor.SurfaceUpdated += OnSurfaceUpdated;
        LoadSurface();
    }
    
    private void OnSurfaceUpdated(object? sender, SurfaceUpdatedEventArgs e)
    {
        if (e.SurfaceId == SurfaceId) // åªå“åº”è‡ªå·±çš„æ›´æ–°
        {
            LoadSurface();
            InvokeAsync(StateHasChanged); // é€šçŸ¥Blazoré‡æ–°æ¸²æŸ“
        }
    }
}
```

æ³¨æ„åˆ°é‚£ä¸ª`InvokeAsync(StateHasChanged)`äº†å—?è¿™æ˜¯Blazorçš„æ ¸å¿ƒæœºåˆ¶ã€‚å› ä¸º`SurfaceUpdated`äº‹ä»¶å¯èƒ½åœ¨éUIçº¿ç¨‹è§¦å‘,å¿…é¡»ç”¨`InvokeAsync`è°ƒåº¦å›UIçº¿ç¨‹,å¦åˆ™ä¼šæŠ›å¼‚å¸¸ã€‚

è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç»†èŠ‚:è°ƒè¯•æ¨¡å¼ã€‚å½“Surfaceè¿˜æ²¡å‡†å¤‡å¥½æ—¶,å®ƒä¼šæ˜¾ç¤ºè¯¦ç»†çš„è¯Šæ–­ä¿¡æ¯,åŒ…æ‹¬ç»„ä»¶æ•°é‡ã€æ ¹ç»„ä»¶IDç­‰ã€‚è¿™å¯¹å¼€å‘è°ƒè¯•å¤ªæœ‰ç”¨äº†!

#### é‡‘åˆš3: A2UIRendererâ€”â€”é€’å½’æ¸²æŸ“å¼•æ“

è¿™æ˜¯æœ€å¤æ‚ä¹Ÿæœ€ç²¾å½©çš„éƒ¨åˆ†ã€‚å®ƒè´Ÿè´£æŠŠç»„ä»¶æ ‘é€’å½’æ¸²æŸ“æˆå®é™…çš„Blazorç»„ä»¶:

```razor
@code {
    [Parameter] public required string SurfaceId { get; set; }
    [Parameter] public required string ComponentId { get; set; }
    
    private void RenderComponent(RenderTreeBuilder builder, ComponentNode node)
    {
        // ğŸ”¥æ ¸å¿ƒ:æ ¹æ®ç»„ä»¶ç±»å‹åŠ¨æ€é€‰æ‹©Blazorç»„ä»¶
        var componentType = node.Type switch
        {
            "Card" => typeof(A2UICard),
            "Button" => typeof(A2UIButton),
            "Text" => typeof(A2UIText),
            "Column" => typeof(A2UIColumn),
            "Row" => typeof(A2UIRow),
            "List" => typeof(A2UIList),
            // ... 15+ç»„ä»¶æ˜ å°„
        };
        
        // åŠ¨æ€æ„å»ºç»„ä»¶å¹¶ä¼ é€’å‚æ•°
        builder.OpenComponent(0, componentType);
        builder.AddAttribute(1, "SurfaceId", SurfaceId);
        builder.AddAttribute(2, "ComponentId", ComponentId);
        builder.AddAttribute(3, "Properties", node.Properties);
        builder.CloseComponent();
    }
}
```

è¿™é‡Œç”¨åˆ°äº†Blazorçš„`RenderTreeBuilder` API,è¿™æ˜¯ä¸€ä¸ªéå¸¸åº•å±‚çš„æ¥å£,å…è®¸ä½ åœ¨è¿è¡Œæ—¶åŠ¨æ€æ„å»ºç»„ä»¶æ ‘ã€‚å¤§å¤šæ•°Blazorå¼€å‘è€…ä¸€è¾ˆå­éƒ½ä¸ä¼šç¢°è¿™ä¸ªAPI,å› ä¸ºå¤ªåº•å±‚äº†ã€‚

ä½†è¿™æ­£æ˜¯å®ç°åŠ¨æ€UIçš„å…³é”®:ä½ æ— æ³•åœ¨ç¼–è¯‘æ—¶çŸ¥é“è¦æ¸²æŸ“ä»€ä¹ˆç»„ä»¶,å¿…é¡»åœ¨è¿è¡Œæ—¶æ ¹æ®JSONæ•°æ®å†³å®šã€‚

#### é‡‘åˆš4: DataBindingResolverâ€”â€”æ•°æ®ç»‘å®šçš„é­”æ³•å¸ˆ

A2UIæ”¯æŒæ•°æ®ç»‘å®š,æ¯”å¦‚è¿™æ ·çš„JSON:

```json
{
  "Text": {
    "text": { "path": "user.name" }
  }
}
```

è¿™ä¸ª`"path": "user.name"`ä¼šè‡ªåŠ¨ä»æ•°æ®æ¨¡å‹ä¸­å–å€¼ã€‚`DataBindingResolver`å°±æ˜¯è´Ÿè´£è§£æè¿™äº›è·¯å¾„çš„:

```csharp
public class DataBindingResolver
{
    private readonly MessageProcessor _messageProcessor;
    
    public object? ResolveBoundValue(
        string surfaceId, 
        Dictionary<string, object> boundValue,
        string? dataContextPath = null)
    {
        // æ”¯æŒä¸¤ç§ç»‘å®šæ–¹å¼
        if (boundValue.ContainsKey("literalString"))
            return boundValue["literalString"]; // å­—é¢å€¼
            
        if (boundValue.ContainsKey("path"))
        {
            var path = boundValue["path"].ToString();
            // ä»æ•°æ®æ¨¡å‹ä¸­å–å€¼
            return _messageProcessor.GetData(surfaceId, path, dataContextPath);
        }
    }
}
```

è¿™é‡Œæœ‰ä¸ªå·§å¦™çš„è®¾è®¡:`dataContextPath`å‚æ•°ã€‚å®ƒç”¨äºæ”¯æŒ**ç›¸å¯¹è·¯å¾„**ç»‘å®šã€‚

æ¯”å¦‚åœ¨Listç»„ä»¶ä¸­,æ¯ä¸ªåˆ—è¡¨é¡¹éƒ½æœ‰è‡ªå·±çš„æ•°æ®ä¸Šä¸‹æ–‡:

```
/contacts/contact1  â† è¿™æ˜¯ç¬¬ä¸€ä¸ªè”ç³»äººçš„ä¸Šä¸‹æ–‡
/contacts/contact2  â† è¿™æ˜¯ç¬¬äºŒä¸ªè”ç³»äººçš„ä¸Šä¸‹æ–‡
```

å½“ä½ åœ¨æ¨¡æ¿ä¸­å†™`"path": "name"`æ—¶,å®ƒä¼šè‡ªåŠ¨è§£æä¸º`/contacts/contact1/name`æˆ–`/contacts/contact2/name`,å–å†³äºå½“å‰æ˜¯å“ªä¸ªåˆ—è¡¨é¡¹ã€‚

#### é‡‘åˆš5: EventDispatcherâ€”â€”ç”¨æˆ·äº¤äº’çš„ä¿¡ä½¿

å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®ã€è¾“å…¥æ–‡æœ¬æ—¶,éœ€è¦æŠŠäº‹ä»¶å‘é€å›Agentã€‚`EventDispatcher`è´Ÿè´£è¿™ä¸ª:

```csharp
public class EventDispatcher
{
    // å…¨å±€äº‹ä»¶:ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è®¢é˜…
    public event EventHandler<UserActionEventArgs>? UserActionDispatched;
    
    // ç»„ä»¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•è§¦å‘äº‹ä»¶
    public void DispatchUserAction(UserAction action)
    {
        UserActionDispatched?.Invoke(this, new UserActionEventArgs(action));
    }
}
```

åœ¨ä½ çš„é¡µé¢ä»£ç ä¸­:

```csharp
protected override void OnInitialized()
{
    EventDispatcher.UserActionDispatched += OnUserAction;
}

private async void OnUserAction(object? sender, UserActionEventArgs e)
{
    // ç”¨æˆ·ç‚¹å‡»äº†æŒ‰é’®!
    var actionName = e.Action.Name; // æ¯”å¦‚ "book_restaurant"
    var context = e.Action.Context; // æ¯”å¦‚ {"restaurantId": "123"}
    
    // å‘é€ç»™Agentå¤„ç†
    await A2AClient.SendActionAsync(actionName, context);
}
```

è¿™ä¸ªè®¾è®¡ç”¨äº†**è§‚å¯Ÿè€…æ¨¡å¼**,å®ç°äº†å®Œå…¨çš„è§£è€¦:ç»„ä»¶ä¸éœ€è¦çŸ¥é“è°åœ¨ç›‘å¬äº‹ä»¶,é¡µé¢ä¹Ÿä¸éœ€è¦çŸ¥é“äº‹ä»¶ä»å“ªä¸ªç»„ä»¶æ¥ã€‚

### 2.3 æ¶ˆæ¯æµè½¬:ä¸€æ¬¡å®Œæ•´çš„äº¤äº’è¿‡ç¨‹

è®©æˆ‘ä»¬è·Ÿè¸ªä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·äº¤äº’:ç”¨æˆ·è¾“å…¥"æ˜¾ç¤ºè”ç³»äºº"â†’AIç”Ÿæˆåˆ—è¡¨â†’ç”¨æˆ·ç‚¹å‡»"æŸ¥çœ‹"æŒ‰é’®ã€‚

```
ç¬¬ä¸€æ­¥:ç”¨æˆ·è¾“å…¥æŸ¥è¯¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·åœ¨èŠå¤©æ¡†è¾“å…¥: "æ˜¾ç¤ºè”ç³»äºº"                         â”‚
â”‚                                                        â”‚
â”‚ A2UIDemo.razor:                                        â”‚
â”‚   await SendQuery("æ˜¾ç¤ºè”ç³»äºº")                        â”‚
â”‚     â†“                                                  â”‚
â”‚   A2AClientService.SendQueryAsync(query, surfaceId)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
ç¬¬äºŒæ­¥:Agentå¤„ç†æŸ¥è¯¢                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MockA2AAgent.ProcessQueryAsync()                      â”‚
â”‚   query.Contains("è”ç³»äºº") ? GetContactListExample()  â”‚
â”‚                                                        â”‚
â”‚ è¿”å›ä¸‰æ¡æ¶ˆæ¯:                                          â”‚
â”‚   1. BeginRendering: { surfaceId, root: "root" }     â”‚
â”‚   2. SurfaceUpdate: { components: [...9ä¸ªç»„ä»¶] }     â”‚
â”‚   3. DataModelUpdate: { contacts: [...3æ¡æ•°æ®] }     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
ç¬¬ä¸‰æ­¥:å¤„ç†JSONæ¶ˆæ¯                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MessageProcessor.ProcessMessages()                    â”‚
â”‚                                                        â”‚
â”‚   BeginRendering â†’ åˆ›å»ºSurface,è®¾ç½®root                â”‚
â”‚   SurfaceUpdate â†’ è§£æ9ä¸ªç»„ä»¶,å­˜å…¥Componentså­—å…¸        â”‚
â”‚   DataModelUpdate â†’ è§£æè”ç³»äººæ•°æ®,å­˜å…¥DataModel        â”‚
â”‚                                                        â”‚
â”‚   è§¦å‘äº‹ä»¶: SurfaceUpdated(surfaceId)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
ç¬¬å››æ­¥:UIæ¸²æŸ“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A2UISurface æ”¶åˆ°äº‹ä»¶                                   â”‚
â”‚   LoadSurface()                                        â”‚
â”‚   InvokeAsync(StateHasChanged) â†’ Blazoré‡æ–°æ¸²æŸ“        â”‚
â”‚                                                        â”‚
â”‚ A2UIRenderer å¼€å§‹é€’å½’æ¸²æŸ“:                             â”‚
â”‚   æ ¹ç»„ä»¶(Column) â†’ List â†’ éå†contactsæ•°æ®              â”‚
â”‚   â†’ ä¸ºæ¯æ¡æ•°æ®å…‹éš†Cardæ¨¡æ¿ â†’ æ¸²æŸ“Textå’ŒButton            â”‚
â”‚                                                        â”‚
â”‚ ç”¨æˆ·çœ‹åˆ°:                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚   â”‚ å¼ ä¸‰                    â”‚                          â”‚
â”‚   â”‚ é«˜çº§å·¥ç¨‹å¸ˆ        [æŸ¥çœ‹] â”‚                          â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚   â”‚ æå››                    â”‚                          â”‚
â”‚   â”‚ äº§å“ç»ç†          [æŸ¥çœ‹] â”‚                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
ç¬¬äº”æ­¥:ç”¨æˆ·ç‚¹å‡»æŒ‰é’®                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A2UIButton:                                           â”‚
â”‚   ç”¨æˆ·ç‚¹å‡» â†’ @onclickè§¦å‘ â†’ OnButtonClick()            â”‚
â”‚   â†“                                                   â”‚
â”‚ EventDispatcher.DispatchUserAction()                  â”‚
â”‚   action: { name: "view_contact",                     â”‚
â”‚             context: { contactName: "å¼ ä¸‰" } }        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
ç¬¬å…­æ­¥:å¤„ç†ç”¨æˆ·åŠ¨ä½œ                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ A2UIDemo.OnUserAction():                              â”‚
â”‚   æ”¶åˆ°äº‹ä»¶ â†’ æ„é€ æŸ¥è¯¢ "ç”¨æˆ·ç‚¹å‡»äº†: view_contact (å¼ ä¸‰)" â”‚
â”‚   â†“                                                   â”‚
â”‚   å†æ¬¡è°ƒç”¨ SendQuery() â†’ è¿›å…¥æ–°ä¸€è½®å¾ªç¯...             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æ³¨æ„åˆ°è¿™ä¸ªæµç¨‹çš„ç²¾å¦™ä¹‹å¤„äº†å—?

1. **å•å‘æ•°æ®æµ**:æ•°æ®æ°¸è¿œä»Agentâ†’Processorâ†’RendereræµåŠ¨,ä»ä¸åå‘
2. **äº‹ä»¶ä¸ŠæŠ¥**:ç”¨æˆ·åŠ¨ä½œé€šè¿‡EventDispatcherä¸ŠæŠ¥,è€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹æ•°æ®
3. **çŠ¶æ€éš”ç¦»**:æ¯ä¸ªSurfaceæœ‰ç‹¬ç«‹çŠ¶æ€,å¤šä¸ªSurfaceå¯ä»¥åŒæ—¶å­˜åœ¨
4. **å¢é‡æ›´æ–°**:åªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†,ä¸æ˜¯æ¯æ¬¡éƒ½é‡å»ºæ•´ä¸ªUI

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™å¥—æ¶æ„èƒ½æ”¯æ’‘å¤æ‚çš„äº¤äº’:å®ƒæŠŠ**æ•°æ®æµ**å’Œ**æ§åˆ¶æµ**å®Œå…¨åˆ†ç¦»å¼€äº†ã€‚

---

## ç¬¬ä¸‰ç« :ç»„ä»¶åº“â€”â€”15ä¸ªç»„ä»¶æ’‘èµ·ä¸€ä¸ªUIå®‡å®™

A2UIå®šä¹‰äº†ä¸€å¥—æ ‡å‡†ç»„ä»¶ç›®å½•,è¿™ä¸ª.NETå®ç°æ”¯æŒäº†15+ç»„ä»¶ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å…¶ä¸­å‡ ä¸ªä»£è¡¨æ€§çš„ã€‚

### 3.1 åŸºç¡€ç»„ä»¶:Textã€Buttonã€Card

è¿™ä¸‰ä¸ªæ˜¯æœ€åŸºç¡€çš„,å‡ ä¹æ‰€æœ‰UIéƒ½ä¼šç”¨åˆ°:

```razor
<!-- A2UIText.razor -->
@inherits A2UIComponentBase

@code {
    private string GetTextContent()
    {
        var textProp = GetProperty("text");
        if (textProp is Dictionary<string, object> boundValue)
        {
            // è§£æç»‘å®šå€¼
            var resolved = DataBindingResolver.ResolveBoundValue(
                SurfaceId, boundValue, DataContextPath);
            return resolved?.ToString() ?? "";
        }
        return "";
    }
    
    private string GetUsageHint()
    {
        return GetProperty("usageHint")?.ToString() ?? "body";
    }
}

@if (GetUsageHint() == "h1")
{
    <h1 class="a2ui-text-h1">@GetTextContent()</h1>
}
else if (GetUsageHint() == "h2")
{
    <h2 class="a2ui-text-h2">@GetTextContent()</h2>
}
else
{
    <p class="a2ui-text-body">@GetTextContent()</p>
}
```

`A2UIButton`çš„å®ç°æ›´æœ‰è¶£,å› ä¸ºå®ƒéœ€è¦å¤„ç†ç”¨æˆ·ç‚¹å‡»:

```razor
<button class="a2ui-button @(IsPrimary() ? "primary" : "")" 
        @onclick="OnButtonClick">
    <A2UIRenderer SurfaceId="@SurfaceId" ComponentId="@GetChildId()" />
</button>

@code {
    private async Task OnButtonClick()
    {
        var action = GetProperty("action") as Dictionary<string, object>;
        if (action == null) return;
        
        var actionName = action["name"]?.ToString();
        var context = ParseActionContext(action);
        
        // è§¦å‘äº‹ä»¶
        EventDispatcher.DispatchUserAction(new UserAction
        {
            Name = actionName,
            SourceComponentId = ComponentId,
            SurfaceId = SurfaceId,
            Context = context
        });
    }
}
```

æ³¨æ„`<A2UIRenderer SurfaceId="@SurfaceId" ComponentId="@GetChildId()" />`,è¿™è¡Œä»£ç é€’å½’æ¸²æŸ“äº†æŒ‰é’®çš„å­ç»„ä»¶(é€šå¸¸æ˜¯Text)ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ å¯ä»¥åµŒå¥—ä»»æ„æ·±åº¦çš„ç»„ä»¶ã€‚

### 3.2 å¸ƒå±€ç»„ä»¶:Columnã€Rowã€List

å¸ƒå±€ç»„ä»¶è´Ÿè´£æ’åˆ—å…¶ä»–ç»„ä»¶ã€‚`Column`(å‚ç›´å¸ƒå±€)å’Œ`Row`(æ°´å¹³å¸ƒå±€)çš„å®ç°å‡ ä¹ä¸€æ ·:

```razor
<!-- A2UIColumn.razor -->
<div class="a2ui-column" style="@GetStyle()">
    @foreach (var childId in GetChildren())
    {
        <div class="a2ui-column-item">
            <A2UIRenderer SurfaceId="@SurfaceId" 
                          ComponentId="@childId"
                          DataContextPath="@DataContextPath" />
        </div>
    }
</div>

@code {
    private List<string> GetChildren()
    {
        var children = GetProperty("children") as Dictionary<string, object>;
        if (children?.ContainsKey("explicitList") == true)
        {
            return ((JsonElement)children["explicitList"])
                .EnumerateArray()
                .Select(e => e.GetString()!)
                .ToList();
        }
        return new List<string>();
    }
}
```

`List`ç»„ä»¶æ˜¯æœ€å¤æ‚çš„,å› ä¸ºå®ƒæ”¯æŒæ¨¡æ¿å’Œæ•°æ®ç»‘å®š:

```csharp
private List<string> GetChildren()
{
    var children = GetProperty("children") as Dictionary<string, object>;
    
    // æ–¹å¼1:æ˜¾å¼å­ç»„ä»¶åˆ—è¡¨
    if (children?.ContainsKey("explicitList") == true)
    {
        return ParseExplicitList(children["explicitList"]);
    }
    
    // æ–¹å¼2:æ¨¡æ¿+æ•°æ®ç»‘å®š
    if (children?.ContainsKey("template") == true)
    {
        var template = children["template"] as Dictionary<string, object>;
        var templateId = template["componentId"]?.ToString();
        var dataBinding = template["dataBinding"]?.ToString();
        
        // ä»æ•°æ®æ¨¡å‹è·å–åˆ—è¡¨æ•°æ®
        var listData = MessageProcessor.GetData(SurfaceId, dataBinding);
        
        if (listData is Dictionary<string, object> dict)
        {
            var result = new List<string>();
            foreach (var key in dict.Keys)
            {
                // ä¸ºæ¯ä¸ªæ•°æ®é¡¹å…‹éš†æ¨¡æ¿
                var clonedId = CloneTemplate(templateId, key);
                result.Add(clonedId);
            }
            return result;
        }
    }
    
    return new List<string>();
}
```

è¿™é‡Œçš„å…³é”®æ˜¯`CloneTemplate`:å®ƒä¼šå¤åˆ¶æ¨¡æ¿ç»„ä»¶,ç”Ÿæˆæ–°çš„ç»„ä»¶ID,å¹¶è®¾ç½®æ­£ç¡®çš„æ•°æ®ä¸Šä¸‹æ–‡è·¯å¾„ã€‚

æ¯”å¦‚,å¯¹äºè¿™ä¸ªJSON:

```json
{
  "List": {
    "children": {
      "template": {
        "componentId": "card-template",
        "dataBinding": "/contacts"
      }
    }
  }
}
```

å¦‚æœ`/contacts`æœ‰3æ¡æ•°æ®,`CloneTemplate`ä¼šåˆ›å»º3ä¸ªæ–°ç»„ä»¶:
- `card-template__contact1` (ä¸Šä¸‹æ–‡è·¯å¾„: `/contacts/contact1`)
- `card-template__contact2` (ä¸Šä¸‹æ–‡è·¯å¾„: `/contacts/contact2`)
- `card-template__contact3` (ä¸Šä¸‹æ–‡è·¯å¾„: `/contacts/contact3`)

è¿™æ ·,æ¨¡æ¿ä¸­çš„`"path": "name"`å°±èƒ½è‡ªåŠ¨è§£æåˆ°æ­£ç¡®çš„è”ç³»äººå§“åã€‚

### 3.3 è¾“å…¥ç»„ä»¶:TextFieldã€CheckBoxã€Slider

è¾“å…¥ç»„ä»¶éœ€è¦æ”¯æŒåŒå‘ç»‘å®šã€‚`TextField`çš„å®ç°:

```razor
<div class="a2ui-textfield">
    @if (!string.IsNullOrEmpty(GetLabel()))
    {
        <label>@GetLabel()</label>
    }
    <input type="text" 
           value="@GetCurrentValue()" 
           @oninput="OnInputChanged"
           placeholder="@GetPlaceholder()" />
</div>

@code {
    private async Task OnInputChanged(ChangeEventArgs e)
    {
        var newValue = e.Value?.ToString() ?? "";
        
        // æ›´æ–°æ•°æ®æ¨¡å‹
        var textProp = GetProperty("text") as Dictionary<string, object>;
        if (textProp?.ContainsKey("path") == true)
        {
            var path = textProp["path"].ToString();
            MessageProcessor.SetData(SurfaceId, path, newValue, DataContextPath);
        }
        
        // å¯é€‰:è§¦å‘changeäº‹ä»¶ç»™Agent
        EventDispatcher.DispatchDataChange(new DataChangeEvent
        {
            Path = path,
            NewValue = newValue,
            SurfaceId = SurfaceId
        });
    }
}
```

è¿™é‡Œæœ‰ä¸ªæœ‰è¶£çš„é—®é¢˜:ä»€ä¹ˆæ—¶å€™åº”è¯¥é€šçŸ¥Agent?

- **æ¯æ¬¡æŒ‰é”®éƒ½é€šçŸ¥**:å®æ—¶æ€§å¥½,ä½†ä¼šäº§ç”Ÿå¤§é‡è¯·æ±‚
- **å¤±å»ç„¦ç‚¹æ—¶é€šçŸ¥**:å‡å°‘è¯·æ±‚,ä½†å»¶è¿Ÿé«˜
- **é˜²æŠ–(debounce)é€šçŸ¥**:å¹³è¡¡å®æ—¶æ€§å’Œæ€§èƒ½,æ¨èæ–¹æ¡ˆ

å®é™…é¡¹ç›®ä¸­,ä½ å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©ç­–ç•¥ã€‚

### 3.4 é«˜çº§ç»„ä»¶:Modalã€Tabsã€MultipleChoice

è¿™äº›ç»„ä»¶æ¶‰åŠæ›´å¤æ‚çš„äº¤äº’ã€‚`Modal`(æ¨¡æ€æ¡†)éœ€è¦ç®¡ç†è‡ªå·±çš„æ˜¾ç¤º/éšè—çŠ¶æ€:

```razor
@if (IsOpen())
{
    <div class="a2ui-modal-overlay" @onclick="OnOverlayClick">
        <div class="a2ui-modal-dialog" @onclick:stopPropagation>
            <div class="a2ui-modal-header">
                <h3>@GetTitle()</h3>
                <button @onclick="CloseModal">Ã—</button>
            </div>
            <div class="a2ui-modal-body">
                <A2UIRenderer SurfaceId="@SurfaceId" 
                              ComponentId="@GetChildId()" />
            </div>
        </div>
    </div>
}

@code {
    private bool IsOpen()
    {
        var isOpenProp = GetProperty("isOpen") as Dictionary<string, object>;
        var resolved = DataBindingResolver.ResolveBoundValue(
            SurfaceId, isOpenProp, DataContextPath);
        return resolved is bool b && b;
    }
    
    private void CloseModal()
    {
        // æ›´æ–°æ•°æ®æ¨¡å‹,å…³é—­æ¨¡æ€æ¡†
        var isOpenProp = GetProperty("isOpen") as Dictionary<string, object>;
        if (isOpenProp?.ContainsKey("path") == true)
        {
            var path = isOpenProp["path"].ToString();
            MessageProcessor.SetData(SurfaceId, path, false, DataContextPath);
        }
    }
}
```

`@onclick:stopPropagation`è¿™ä¸ªæŒ‡ä»¤å¾ˆå…³é”®:å®ƒé˜»æ­¢äº†ç‚¹å‡»å¯¹è¯æ¡†å†…å®¹æ—¶å…³é—­æ¨¡æ€æ¡†(åªæœ‰ç‚¹å‡»é®ç½©å±‚æ‰å…³é—­)ã€‚

---

## ç¬¬å››ç« :å®æˆ˜åœºæ™¯â€”â€”çœ‹çœ‹å®ƒèƒ½å¹²ä»€ä¹ˆ

ç†è®ºè®²å®Œäº†,è¯¥çœ‹çœ‹å®é™…èƒ½å¹²ä»€ä¹ˆæ´»äº†ã€‚

### 4.1 åœºæ™¯ä¸€:æ™ºèƒ½å®¢æœç³»ç»Ÿ

æƒ³è±¡ä½ åœ¨åšä¸€ä¸ªå®¢æœèŠå¤©æœºå™¨äºº:

**ç”¨æˆ·**: "æˆ‘æƒ³é€€è´§"

**ä¼ ç»Ÿåšæ³•**:
1. å†™æ­»ä¸€ä¸ªé€€è´§è¡¨å•é¡µé¢
2. ç”¨if-elseåˆ¤æ–­æ˜¾ç¤ºå“ªä¸ªé¡µé¢
3. æ¯æ¬¡éœ€æ±‚å˜åŒ–(æ¯”å¦‚å¢åŠ å­—æ®µ)éƒ½è¦æ”¹ä»£ç 

**A2UIåšæ³•**:
```csharp
// Agentæ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€ç”Ÿæˆè¡¨å•
public async Task<List<ServerToClientMessage>> HandleReturnRequest(Order order)
{
    // å¦‚æœæ˜¯è¡£æœ,æ˜¾ç¤ºå°ºç ä¸åˆé€‚é€‰é¡¹
    // å¦‚æœæ˜¯ç”µå­äº§å“,æ˜¾ç¤ºè´¨é‡é—®é¢˜é€‰é¡¹
    // å¦‚æœè¶…è¿‡7å¤©,æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯
    
    var formFields = DetermineFieldsBasedOnContext(order);
    return GenerateA2UIForm(formFields);
}
```

Agentå¯ä»¥æ ¹æ®è®¢å•ç±»å‹ã€æ—¶é—´ã€ç”¨æˆ·ç­‰çº§ç­‰å› ç´ ,åŠ¨æ€å†³å®šæ˜¾ç¤ºä»€ä¹ˆå­—æ®µã€ä»€ä¹ˆæç¤ºè¯­ã€ä»€ä¹ˆæŒ‰é’®ã€‚å®Œå…¨ä¸éœ€è¦å‰ç«¯ä»£ç æ”¹åŠ¨ã€‚

### 4.2 åœºæ™¯äºŒ:æ•°æ®å¯è§†åŒ–å¤§å±

**ç”¨æˆ·**: "æ˜¾ç¤ºä»Šå¤©çš„é”€å”®æ•°æ®"

**Agentè¿”å›**:
- å¦‚æœæ•°æ®<=5æ¡:è¿”å›Cardåˆ—è¡¨
- å¦‚æœæ•°æ®6-20æ¡:è¿”å›Tableç»„ä»¶
- å¦‚æœæ•°æ®>20æ¡:è¿”å›åˆ†é¡µTable+ç­›é€‰å™¨

è¿™ä¸ªå†³ç­–é€»è¾‘å®Œå…¨åœ¨Agentç«¯,å‰ç«¯åªéœ€è¦æ¸²æŸ“å®ƒè¿”å›çš„ç»„ä»¶ã€‚

æ›´ç‚«çš„æ˜¯,Agentå¯ä»¥æ ¹æ®æ•°æ®ç‰¹å¾é€‰æ‹©å¯è§†åŒ–æ–¹å¼:
- è¶‹åŠ¿æ•°æ® â†’ æŠ˜çº¿å›¾ç»„ä»¶
- åˆ†ç±»å¯¹æ¯” â†’ æŸ±çŠ¶å›¾ç»„ä»¶
- å æ¯”åˆ†æ â†’ é¥¼å›¾ç»„ä»¶

### 4.3 åœºæ™¯ä¸‰:ä¸ªæ€§åŒ–æ¨èç•Œé¢

æ¯ä¸ªç”¨æˆ·çœ‹åˆ°çš„ç•Œé¢å¯ä»¥å®Œå…¨ä¸åŒ:

```csharp
public async Task<List<ServerToClientMessage>> GenerateHomePage(User user)
{
    var components = new List<ComponentDefinition>();
    
    // æ–°ç”¨æˆ·:æ˜¾ç¤ºå¼•å¯¼æ•™ç¨‹
    if (user.IsNewUser)
        components.Add(CreateTutorialCard());
    
    // VIPç”¨æˆ·:æ˜¾ç¤ºä¸“å±ä¼˜æƒ 
    if (user.IsVIP)
        components.Add(CreateVIPDealsCard());
    
    // æ ¹æ®æµè§ˆå†å²æ¨èå•†å“
    var recommendations = await GetRecommendations(user.BrowsingHistory);
    components.Add(CreateProductList(recommendations));
    
    return BuildA2UIMessages(components);
}
```

å…³é”®æ˜¯:è¿™äº›é€»è¾‘éƒ½åœ¨åç«¯Agent,å‰ç«¯å®Œå…¨ä¸éœ€è¦çŸ¥é“æœ‰å“ªäº›ç”¨æˆ·ç±»å‹ã€æœ‰å“ªäº›æ¨èè§„åˆ™ã€‚

### 4.4 åœºæ™¯å››:ä½ä»£ç å¹³å°

è¿™æ˜¯æˆ‘è§‰å¾—æœ€æœ‰æ½œåŠ›çš„åº”ç”¨åœºæ™¯:

**ç”¨æˆ·**(ä¸šåŠ¡äººå‘˜): "å¸®æˆ‘åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç®¡ç†è¡¨å•,åŒ…æ‹¬å§“åã€æ‰‹æœºã€åœ°å€ã€å¤‡æ³¨"

**AI Agent**: 
1. ç†è§£éœ€æ±‚
2. ç”ŸæˆåŒ…å«4ä¸ªTextFieldçš„è¡¨å•
3. ç”Ÿæˆä¿å­˜æŒ‰é’®
4. ç”Ÿæˆè¡¨å•éªŒè¯é€»è¾‘
5. è¿”å›A2UI JSON

**å‰ç«¯**: ç›´æ¥æ¸²æŸ“,ä¸éœ€è¦å¼€å‘äººå‘˜ä»‹å…¥

ä¸šåŠ¡äººå‘˜å¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€æè¿°éœ€æ±‚,AIç›´æ¥ç”Ÿæˆå¯ç”¨çš„ç•Œé¢ã€‚å¦‚æœä¸æ»¡æ„,ç»§ç»­å¯¹è¯è°ƒæ•´:"æŠŠå¤‡æ³¨æ”¹æˆå¤šè¡Œæ–‡æœ¬æ¡†"ã€"å¢åŠ ä¸€ä¸ªä¸Šä¼ é™„ä»¶çš„æŒ‰é’®"ã€‚

è¿™ä¸å°±æ˜¯**å¯¹è¯å¼ä½ä»£ç **å—?

---

## ç¬¬äº”ç« :é›†æˆçœŸå®LLMâ€”â€”ä»Mockåˆ°ç”Ÿäº§

å¥½,åˆ°ç°åœ¨ä½ è‚¯å®šä¼šé—®:è¿™äº›ä¾‹å­éƒ½æ˜¯Mockçš„,æ€ä¹ˆæ¥å…¥çœŸå®çš„LLM?

### 5.1 æ¥å…¥Google Gemini

```csharp
public class GeminiA2AAgent
{
    private readonly GenerativeModel _model;
    private readonly string _systemPrompt = @"
You are a UI generation AI. You generate user interfaces using A2UI JSON protocol.

When user asks for UI, respond with JSON array containing:
1. beginRendering message with surfaceId and root component ID
2. surfaceUpdate message with all components
3. (optional) dataModelUpdate message with data

Available components: Card, Column, Row, Text, Button, Image, Icon, List, TextField, CheckBox, DateTimeInput, Slider, Divider

Example response:
[
  {
    ""beginRendering"": {
      ""surfaceId"": ""demo"",
      ""root"": ""root-card""
    }
  },
  {
    ""surfaceUpdate"": {
      ""surfaceId"": ""demo"",
      ""components"": [
        {
          ""id"": ""root-card"",
          ""component"": {
            ""Card"": { ""child"": ""text1"" }
          }
        },
        {
          ""id"": ""text1"",
          ""component"": {
            ""Text"": {
              ""text"": { ""literalString"": ""Hello"" },
              ""usageHint"": ""h1""
            }
          }
        }
      ]
    }
  }
]

Respond ONLY with valid JSON. No explanations.
";

    public GeminiA2AAgent(string apiKey)
    {
        _model = new GenerativeModel(apiKey, "gemini-2.0-flash-exp");
    }

    public async Task<List<ServerToClientMessage>> ProcessQueryAsync(string query)
    {
        var prompt = $"{_systemPrompt}\n\nUser request: {query}";
        
        var response = await _model.GenerateContentAsync(prompt);
        var text = response.Text;
        
        // æå–JSON(LLMå¯èƒ½ä¼šåœ¨JSONå‰ååŠ è¯´æ˜æ–‡å­—)
        var jsonMatch = Regex.Match(text, @"\[[\s\S]*\]");
        if (!jsonMatch.Success)
            throw new Exception("LLM response is not valid JSON");
        
        var json = jsonMatch.Value;
        
        // ååºåˆ—åŒ–ä¸ºA2UIæ¶ˆæ¯
        var messages = JsonSerializer.Deserialize<List<ServerToClientMessage>>(
            json, 
            new JsonSerializerOptions { PropertyNameCaseInsensitive = true }
        );
        
        return messages ?? new List<ServerToClientMessage>();
    }
}
```

åœ¨`Program.cs`ä¸­æ³¨å†Œ:

```csharp
builder.Services.AddScoped<GeminiA2AAgent>(sp => 
    new GeminiA2AAgent(builder.Configuration["Gemini:ApiKey"]!));
    
builder.Services.AddScoped<A2AClientService>();
```

### 5.2 æé«˜LLMè¾“å‡ºè´¨é‡çš„æŠ€å·§

çœŸå®åœºæ™¯ä¸­,LLMè¾“å‡ºçš„JSONå¯èƒ½ä¸å®Œç¾ã€‚è¿™é‡Œæœ‰å‡ ä¸ªæŠ€å·§:

#### æŠ€å·§1:æä¾›å®Œæ•´çš„Schema

åœ¨Promptä¸­åŒ…å«å®Œæ•´çš„A2UI JSON Schema,æœ€å¥½å¸¦æ³¨é‡Š:

```
Component structure:
{
  "id": "unique-component-id",  // Required: must be unique
  "component": {
    "ComponentType": {           // Only ONE type per component
      "property1": value,
      "property2": value
    }
  }
}

BoundValue can be:
{ "literalString": "text" }  // Static text
{ "path": "data.field" }     // Bind to data model
{ "path": "/absolute/path" } // Absolute path
```

#### æŠ€å·§2:ä½¿ç”¨Few-Shot Examples

åœ¨Promptä¸­æä¾›2-3ä¸ªå®Œæ•´ç¤ºä¾‹:

```
Example 1: Simple card
[
  { "beginRendering": {...} },
  { "surfaceUpdate": {...} }
]

Example 2: List with data binding
[...]

Example 3: Form with validation
[...]

Now generate UI for user request: [ç”¨æˆ·è¯·æ±‚]
```

#### æŠ€å·§3:å¢åŠ éªŒè¯å’Œä¿®å¤

```csharp
public class RobustA2AAgent
{
    private GeminiA2AAgent _agent;
    
    publi